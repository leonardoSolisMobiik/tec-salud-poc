2025-06-22 23:11:44 - app.services.chroma_service - ERROR - chroma_service - initialize:70 - ❌ Failed to initialize Chroma service: Collection [expedientes_medicos] already exists
2025-06-22 23:11:44 - uvicorn.error - ERROR - on - send:121 - Traceback (most recent call last):
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/app/services/chroma_service.py", line 53, in initialize
    self.collection = self.client.get_collection(
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~^
        name=settings.CHROMA_COLLECTION_NAME,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        embedding_function=self.embedding_function
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/chromadb/api/client.py", line 199, in get_collection
    validate_embedding_function_conflict_on_get(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        embedding_function, persisted_ef_config
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/chromadb/api/collection_configuration.py", line 762, in validate_embedding_function_conflict_on_get
    embedding_function.name() != "default"
    ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AzureOpenAIEmbeddingFunction' object has no attribute 'name'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/app/services/chroma_service.py", line 59, in initialize
    self.collection = self.client.create_collection(
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        name=settings.CHROMA_COLLECTION_NAME,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        embedding_function=self.embedding_function,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        metadata={"description": "TecSalud medical documents collection"}
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/chromadb/api/client.py", line 168, in create_collection
    model = self._server.create_collection(
        name=name,
    ...<4 lines>...
        configuration=configuration,
    )
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/chromadb/api/rust.py", line 227, in create_collection
    collection = self.bindings.create_collection(
        name, configuration_json_str, metadata, get_or_create, tenant, database
    )
chromadb.errors.InternalError: Collection [expedientes_medicos] already exists

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 692, in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/fastapi/routing.py", line 133, in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ~~~~~~~~~~~~~~~~^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/main.py", line 37, in lifespan
    await chroma_service.initialize()
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/app/services/chroma_service.py", line 71, in initialize
    raise ChromaError(f"Failed to initialize Chroma: {str(e)}")
app.utils.exceptions.ChromaError: Failed to initialize Chroma: Collection [expedientes_medicos] already exists

2025-06-22 23:11:44 - uvicorn.error - ERROR - on - startup:59 - Application startup failed. Exiting.
2025-06-22 23:32:00 - app.agents.medical_coordinator - ERROR - medical_coordinator - _classify_query:212 - ❌ Query classification failed: Azure OpenAI service not initialized
2025-06-22 23:32:00 - app.agents.medical_coordinator - ERROR - medical_coordinator - _route_to_agent:282 - ❌ Agent routing failed for general: Azure OpenAI service not initialized
2025-06-22 23:32:00 - app.agents.medical_coordinator - ERROR - medical_coordinator - process_request:130 - ❌ Coordinator error: Azure OpenAI service not initialized
2025-06-22 23:32:00 - app.api.endpoints.chat - ERROR - chat - medical_chat:76 - ❌ Medical chat error: Coordination failed: Azure OpenAI service not initialized
2025-06-22 23:32:11 - app.agents.medical_coordinator - ERROR - medical_coordinator - _classify_query:212 - ❌ Query classification failed: Azure OpenAI service not initialized
2025-06-22 23:32:11 - app.agents.medical_coordinator - ERROR - medical_coordinator - _route_to_agent:282 - ❌ Agent routing failed for general: Azure OpenAI service not initialized
2025-06-22 23:32:11 - app.agents.medical_coordinator - ERROR - medical_coordinator - process_request:130 - ❌ Coordinator error: Azure OpenAI service not initialized
2025-06-22 23:32:11 - app.api.endpoints.chat - ERROR - chat - medical_chat:76 - ❌ Medical chat error: Coordination failed: Azure OpenAI service not initialized
2025-06-22 23:36:26 - app.agents.medical_coordinator - ERROR - medical_coordinator - _classify_query:212 - ❌ Query classification failed: Azure OpenAI service not initialized
2025-06-22 23:36:26 - app.agents.medical_coordinator - ERROR - medical_coordinator - _route_to_agent:282 - ❌ Agent routing failed for general: Azure OpenAI service not initialized
2025-06-22 23:36:26 - app.agents.medical_coordinator - ERROR - medical_coordinator - process_request:130 - ❌ Coordinator error: Azure OpenAI service not initialized
2025-06-22 23:36:26 - app.api.endpoints.chat - ERROR - chat - medical_chat:76 - ❌ Medical chat error: Coordination failed: Azure OpenAI service not initialized
2025-06-22 23:37:02 - app.agents.medical_coordinator - ERROR - medical_coordinator - _classify_query:212 - ❌ Query classification failed: Azure OpenAI service not initialized
2025-06-22 23:37:02 - app.agents.medical_coordinator - ERROR - medical_coordinator - _route_to_agent:282 - ❌ Agent routing failed for general: Azure OpenAI service not initialized
2025-06-22 23:37:02 - app.agents.medical_coordinator - ERROR - medical_coordinator - process_request:130 - ❌ Coordinator error: Azure OpenAI service not initialized
2025-06-22 23:37:02 - app.api.endpoints.chat - ERROR - chat - medical_chat:76 - ❌ Medical chat error: Coordination failed: Azure OpenAI service not initialized
2025-06-22 23:38:41 - uvicorn.error - ERROR - on - send:121 - Traceback (most recent call last):
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 692, in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/fastapi/routing.py", line 133, in merged_lifespan
    async with original_context(app) as maybe_original_state:
               ~~~~~~~~~~~~~~~~^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 214, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/main.py", line 41, in lifespan
    azure_service = AzureOpenAIService()
                    ^^^^^^^^^^^^^^^^^^
NameError: name 'AzureOpenAIService' is not defined. Did you mean: 'azure_openai_service'?

2025-06-22 23:38:41 - uvicorn.error - ERROR - on - startup:59 - Application startup failed. Exiting.
2025-06-22 23:40:09 - app.services.azure_openai_service - ERROR - azure_openai_service - chat_completion:132 - ❌ Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:40:09 - app.agents.medical_coordinator - ERROR - medical_coordinator - _route_to_agent:291 - ❌ Agent routing failed for general: Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:40:09 - app.agents.medical_coordinator - ERROR - medical_coordinator - process_request:139 - ❌ Coordinator error: "ChatResponse" object has no field "metadata"
2025-06-22 23:40:09 - app.api.endpoints.chat - ERROR - chat - medical_chat:76 - ❌ Medical chat error: Coordination failed: "ChatResponse" object has no field "metadata"
2025-06-22 23:40:38 - app.services.azure_openai_service - ERROR - azure_openai_service - chat_completion:132 - ❌ Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:40:38 - app.agents.medical_coordinator - ERROR - medical_coordinator - _route_to_agent:291 - ❌ Agent routing failed for general: Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:40:39 - app.agents.medical_coordinator - ERROR - medical_coordinator - process_request:139 - ❌ Coordinator error: "ChatResponse" object has no field "metadata"
2025-06-22 23:40:39 - app.api.endpoints.chat - ERROR - chat - medical_chat:76 - ❌ Medical chat error: Coordination failed: "ChatResponse" object has no field "metadata"
2025-06-22 23:41:00 - app.agents.medical_coordinator - ERROR - medical_coordinator - process_request:139 - ❌ Coordinator error: "ChatResponse" object has no field "metadata"
2025-06-22 23:41:00 - app.api.endpoints.chat - ERROR - chat - medical_chat:76 - ❌ Medical chat error: Coordination failed: "ChatResponse" object has no field "metadata"
2025-06-22 23:42:16 - app.services.azure_openai_service - ERROR - azure_openai_service - chat_completion:132 - ❌ Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:42:16 - app.agents.medical_coordinator - ERROR - medical_coordinator - _route_to_agent:291 - ❌ Agent routing failed for general: Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:42:16 - app.agents.medical_coordinator - ERROR - medical_coordinator - process_request:139 - ❌ Coordinator error: "ChatResponse" object has no field "metadata"
2025-06-22 23:42:16 - app.api.endpoints.chat - ERROR - chat - medical_chat:92 - ❌ Medical chat error: Coordination failed: "ChatResponse" object has no field "metadata"
2025-06-22 23:44:16 - app.services.azure_openai_service - ERROR - azure_openai_service - chat_completion:132 - ❌ Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:44:16 - app.agents.medical_coordinator - ERROR - medical_coordinator - _route_to_agent:291 - ❌ Agent routing failed for general: Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:44:16 - app.agents.medical_coordinator - ERROR - medical_coordinator - process_request:139 - ❌ Coordinator error: "ChatResponse" object has no field "metadata"
2025-06-22 23:44:16 - app.api.endpoints.chat - ERROR - chat - medical_chat:92 - ❌ Medical chat error: Coordination failed: "ChatResponse" object has no field "metadata"
2025-06-22 23:45:13 - app.services.azure_openai_service - ERROR - azure_openai_service - chat_completion:132 - ❌ Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:45:13 - app.agents.medical_coordinator - ERROR - medical_coordinator - _route_to_agent:291 - ❌ Agent routing failed for general: Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:45:13 - app.agents.medical_coordinator - ERROR - medical_coordinator - process_request:139 - ❌ Coordinator error: "ChatResponse" object has no field "metadata"
2025-06-22 23:45:13 - app.api.endpoints.chat - ERROR - chat - medical_chat:92 - ❌ Medical chat error: Coordination failed: "ChatResponse" object has no field "metadata"
2025-06-22 23:45:39 - app.agents.medical_coordinator - ERROR - medical_coordinator - process_request:139 - ❌ Coordinator error: "ChatResponse" object has no field "metadata"
2025-06-22 23:45:39 - app.api.endpoints.chat - ERROR - chat - medical_chat:92 - ❌ Medical chat error: Coordination failed: "ChatResponse" object has no field "metadata"
2025-06-22 23:46:57 - app.services.azure_openai_service - ERROR - azure_openai_service - chat_completion:132 - ❌ Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:46:57 - app.api.endpoints.chat - ERROR - chat - medical_chat:107 - ❌ Azure OpenAI error: Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:47:12 - app.services.azure_openai_service - ERROR - azure_openai_service - chat_completion:132 - ❌ Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:47:12 - app.api.endpoints.chat - ERROR - chat - medical_chat:107 - ❌ Azure OpenAI error: Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:48:03 - app.services.azure_openai_service - ERROR - azure_openai_service - chat_completion:132 - ❌ Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:48:03 - app.api.endpoints.chat - ERROR - chat - medical_chat:107 - ❌ Azure OpenAI error: Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:49:29 - app.services.azure_openai_service - ERROR - azure_openai_service - chat_completion:132 - ❌ Chat completion failed: 'str' object has no attribute 'value'
2025-06-22 23:49:29 - app.api.endpoints.chat - ERROR - chat - medical_chat:107 - ❌ Azure OpenAI error: Chat completion failed: 'str' object has no attribute 'value'
2025-06-23 08:29:23 - app.services.azure_openai_service - ERROR - azure_openai_service - chat_completion:132 - ❌ Chat completion failed: 'str' object has no attribute 'value'
2025-06-23 08:29:23 - app.agents.medical_coordinator - ERROR - medical_coordinator - _route_to_agent:291 - ❌ Agent routing failed for general: Chat completion failed: 'str' object has no attribute 'value'
2025-06-23 08:29:24 - app.agents.medical_coordinator - ERROR - medical_coordinator - process_request:139 - ❌ Coordinator error: "ChatResponse" object has no field "metadata"
2025-06-23 08:29:24 - app.api.endpoints.chat - ERROR - chat - medical_chat:92 - ❌ Medical chat error: Coordination failed: "ChatResponse" object has no field "metadata"
2025-06-23 08:40:25 - app.agents.quick_response_agent - ERROR - quick_response_agent - process_stream:170 - ❌ Quick streaming failed: name 'azure_openai_service' is not defined
2025-06-23 08:57:47 - app.agents.quick_response_agent - ERROR - quick_response_agent - process_stream:170 - ❌ Quick streaming failed: 'async for' requires an object with __aiter__ method, got coroutine
2025-06-23 09:53:39 - app.services.chroma_service - ERROR - chroma_service - get_patient_context:240 - ❌ Failed to get patient context: Chroma service not initialized
2025-06-23 09:53:40 - app.agents.quick_response_agent - ERROR - quick_response_agent - process_stream:170 - ❌ Quick streaming failed: 'async for' requires an object with __aiter__ method, got coroutine
2025-06-23 10:26:56 - app.services.chroma_service - ERROR - chroma_service - get_patient_context:240 - ❌ Failed to get patient context: Chroma service not initialized
2025-06-23 10:27:11 - app.services.chroma_service - ERROR - chroma_service - get_patient_context:240 - ❌ Failed to get patient context: Chroma service not initialized
2025-06-23 10:36:44 - app.services.azure_openai_service - ERROR - azure_openai_service - chat_completion_stream:202 - ❌ Streaming completion failed: 'str' object has no attribute 'value'
2025-06-23 10:36:44 - app.agents.medical_coordinator - ERROR - medical_coordinator - _route_to_agent_stream:355 - ❌ Streaming routing failed: Streaming completion failed: 'str' object has no attribute 'value'
2025-06-23 10:38:17 - app.services.azure_openai_service - ERROR - azure_openai_service - chat_completion_stream:202 - ❌ Streaming completion failed: 'str' object has no attribute 'value'
2025-06-23 10:38:17 - app.agents.medical_coordinator - ERROR - medical_coordinator - _route_to_agent_stream:355 - ❌ Streaming routing failed: Streaming completion failed: 'str' object has no attribute 'value'
2025-06-23 18:19:40 - app.api.endpoints.patients_db - ERROR - patients_db - search_patients:213 - ❌ Patient search failed: 1 validation error for PatientSearchResult
patients.0.birth_date
  Field required [type=missing, input_value={'id': '7', 'name': 'Jos...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-06-23 18:19:41 - app.api.endpoints.patients_db - ERROR - patients_db - search_patients:213 - ❌ Patient search failed: 1 validation error for PatientSearchResult
patients.0.birth_date
  Field required [type=missing, input_value={'id': '7', 'name': 'Jos...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-06-23 18:19:42 - app.api.endpoints.patients_db - ERROR - patients_db - search_patients:213 - ❌ Patient search failed: 1 validation error for PatientSearchResult
patients.0.birth_date
  Field required [type=missing, input_value={'id': '7', 'name': 'Jos...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-06-23 18:19:43 - app.api.endpoints.patients_db - ERROR - patients_db - search_patients:213 - ❌ Patient search failed: 1 validation error for PatientSearchResult
patients.0.birth_date
  Field required [type=missing, input_value={'id': '7', 'name': 'Jos...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-06-23 18:19:49 - app.api.endpoints.patients_db - ERROR - patients_db - search_patients:213 - ❌ Patient search failed: 3 validation errors for PatientSearchResult
patients.0.birth_date
  Field required [type=missing, input_value={'id': '3', 'name': 'Pedr...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
patients.1.birth_date
  Field required [type=missing, input_value={'id': '11', 'name': 'Ale...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
patients.2.birth_date
  Field required [type=missing, input_value={'id': '15', 'name': 'Ale...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-06-23 18:19:51 - app.api.endpoints.patients_db - ERROR - patients_db - search_patients:213 - ❌ Patient search failed: 10 validation errors for PatientSearchResult
patients.0.birth_date
  Field required [type=missing, input_value={'id': '1', 'name': 'Andr...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
patients.1.birth_date
  Field required [type=missing, input_value={'id': '2', 'name': 'Artu...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
patients.2.birth_date
  Field required [type=missing, input_value={'id': '3', 'name': 'Pedr...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
patients.3.birth_date
  Field required [type=missing, input_value={'id': '4', 'name': 'Luc...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
patients.4.birth_date
  Field required [type=missing, input_value={'id': '5', 'name': 'Raú...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
patients.5.birth_date
  Field required [type=missing, input_value={'id': '6', 'name': 'Raú...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
patients.6.birth_date
  Field required [type=missing, input_value={'id': '7', 'name': 'Jos...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
patients.7.birth_date
  Field required [type=missing, input_value={'id': '8', 'name': 'Carm...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
patients.8.birth_date
  Field required [type=missing, input_value={'id': '9', 'name': 'Ana ...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
patients.9.birth_date
  Field required [type=missing, input_value={'id': '10', 'name': 'Lau...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-06-23 18:19:53 - app.api.endpoints.patients_db - ERROR - patients_db - search_patients:213 - ❌ Patient search failed: 3 validation errors for PatientSearchResult
patients.0.birth_date
  Field required [type=missing, input_value={'id': '3', 'name': 'Pedr...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
patients.1.birth_date
  Field required [type=missing, input_value={'id': '11', 'name': 'Ale...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
patients.2.birth_date
  Field required [type=missing, input_value={'id': '15', 'name': 'Ale...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-06-23 18:19:54 - app.api.endpoints.patients_db - ERROR - patients_db - search_patients:213 - ❌ Patient search failed: 2 validation errors for PatientSearchResult
patients.0.birth_date
  Field required [type=missing, input_value={'id': '11', 'name': 'Ale...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
patients.1.birth_date
  Field required [type=missing, input_value={'id': '15', 'name': 'Ale...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-06-23 18:20:02 - app.api.endpoints.patients_db - ERROR - patients_db - search_patients:213 - ❌ Patient search failed: 3 validation errors for PatientSearchResult
patients.0.birth_date
  Field required [type=missing, input_value={'id': '3', 'name': 'Pedr...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
patients.1.birth_date
  Field required [type=missing, input_value={'id': '11', 'name': 'Ale...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
patients.2.birth_date
  Field required [type=missing, input_value={'id': '15', 'name': 'Ale...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-06-23 18:23:05 - app.api.endpoints.patients_db - ERROR - patients_db - search_patients:213 - ❌ Patient search failed: 1 validation error for PatientSearchResult
patients.0.birth_date
  Field required [type=missing, input_value={'id': '1', 'name': 'Andr...: '2025-06-24T00:15:21'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-06-23 18:24:03 - uvicorn.error - ERROR - httptools_impl - run_asgi:414 - Exception in ASGI application
Traceback (most recent call last):
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/fastapi/routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "/Users/leonardosolis/Developer/tecsalud-fullstack/backend/venv/lib/python3.13/site-packages/fastapi/routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'patients', 0, 'birth_date'), 'msg': 'Field required', 'input': {'id': '1', 'name': 'Andrea Pérez García', 'age': 24, 'gender': 'femenino', 'medical_record_number': 'EXP-2024000', 'phone': '524447242529', 'email': 'andrea.pérez.garcía@yahoo.com', 'conditions': ['Reflujo gastroesofágico'], 'last_visit': '2025-06-24T00:15:21'}}

