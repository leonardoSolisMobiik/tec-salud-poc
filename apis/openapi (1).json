{"openapi":"3.1.0","info":{"title":"Chatbot Inteligente para Expedientes","description":"\nAPI robusta para chatbot inteligente que permite cargar y procesar documentos médicos,\nrealizar OCR con Azure Document Intelligence y almacenar la información en MongoDB.\n\n## Características\n\n* **Carga de documentos**: Permite cargar uno o más documentos médicos\n* **OCR avanzado**: Procesamiento con Azure Document Intelligence modelo read\n* **Almacenamiento seguro**: Documentos en Azure Storage Account\n* **Base de datos**: Metadata y contenido en MongoDB\n* **Arquitectura escalable**: Diseño modular y versionado\n","version":"1.0.0"},"paths":{"/api/v1/documents/upload":{"post":{"tags":["documents"],"summary":"Upload Document","description":"Upload a single document for processing.\n\nThis endpoint accepts a file upload and processes it through the complete workflow:\n1. Upload to Azure Storage\n2. Perform OCR using Azure Document Intelligence\n3. Store extracted text and information in MongoDB\n\nArgs:\n    file: Document file to upload\n    data: Validated upload data (user_id, description, tags)\n\nReturns:\n    DocumentUploadResponse: Processing results","operationId":"upload_document_api_v1_documents_upload_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_upload_document_api_v1_documents_upload_post"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DocumentUploadResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/documents/upload/batch":{"post":{"tags":["documents"],"summary":"Upload Documents Batch","description":"Upload multiple documents for batch processing.\n\nThis endpoint processes multiple files in a batch operation with optimized error handling.\nEach file goes through the same processing workflow as single upload but errors are handled individually.\n\nArgs:\n    files: List of document files to upload\n    data: Validated batch upload data (user_id, batch_description, batch_tags)\n\nReturns:\n    BatchUploadResponse: Batch processing results with success/failure breakdown","operationId":"upload_documents_batch_api_v1_documents_upload_batch_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_upload_documents_batch_api_v1_documents_upload_batch_post"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchUploadResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/documents/":{"get":{"tags":["documents"],"summary":"List Documents","description":"List documents with required user_id filtering and optional batch filtering.\n\nThis endpoint provides comprehensive document listing with enhanced pagination,\nfiltering capabilities, and specific error handling. The user_id is required\nto ensure users can only see their own documents.\n\nArgs:\n    params: Validated search parameters (user_id required, batch_id optional, limit, skip)\n\nReturns:\n    DocumentSearchResponse: Paginated list of documents with metadata\n    \nRaises:\n    400 Bad Request: Invalid search parameters or missing user_id\n    503 Service Unavailable: Database connection issues","operationId":"list_documents_api_v1_documents__get","parameters":[{"name":"user_id","in":"query","required":true,"schema":{"type":"string","minLength":1,"description":"Filter documents by user ID (required)","title":"User Id"},"description":"Filter documents by user ID (required)"},{"name":"batch_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter documents by batch ID","title":"Batch Id"},"description":"Filter documents by batch ID"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"Maximum number of results","default":10,"title":"Limit"},"description":"Maximum number of results"},{"name":"skip","in":"query","required":false,"schema":{"type":"integer","minimum":0,"description":"Number of results to skip","default":0,"title":"Skip"},"description":"Number of results to skip"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DocumentSearchResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/documents/{document_id}":{"get":{"tags":["documents"],"summary":"Get Document Info","description":"Get information about a specific document.\n\nThis endpoint retrieves detailed information about a document by its ID.\nIt includes comprehensive validation and specific error handling.\n\nArgs:\n    document_id: Unique document identifier (MongoDB ObjectId format)\n\nReturns:\n    DocumentInfoResponse: Complete document information\n    \nRaises:\n    400 Bad Request: Invalid document ID format\n    404 Not Found: Document not found\n    503 Service Unavailable: Database connection issues","operationId":"get_document_info_api_v1_documents__document_id__get","parameters":[{"name":"document_id","in":"path","required":true,"schema":{"type":"string","title":"Document Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DocumentInfoResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"bearerAuth":[]}]},"delete":{"tags":["documents"],"summary":"Delete Document","description":"Delete a document completely.\n\nThis removes the document from both MongoDB and Azure Storage.\nIt includes comprehensive validation and specific error handling.\n\nArgs:\n    document_id: Unique document identifier (MongoDB ObjectId format)\n\nReturns:\n    DocumentDeleteResponse: Deletion result\n    \nRaises:\n    400 Bad Request: Invalid document ID format\n    404 Not Found: Document not found\n    503 Service Unavailable: Database connection issues","operationId":"delete_document_api_v1_documents__document_id__delete","parameters":[{"name":"document_id","in":"path","required":true,"schema":{"type":"string","title":"Document Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DocumentDeleteResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/chat/sessions":{"post":{"tags":["chat"],"summary":"Create Chat Session","description":"Create a new chat session for a document with comprehensive validation and error handling.\n\nThis endpoint provides enhanced error handling for chat session creation,\nincluding specific validation for document IDs, user IDs, document status,\nand content availability.\n\nArgs:\n    data: Session creation data (user_id, document_id, session_name)\n\nReturns:\n    ChatSessionResponse: Created session information\n    \nRaises:\n    400 Bad Request: Invalid input data (user_id or document_id format)\n    403 Forbidden: User doesn't have access to document\n    404 Not Found: Document not found\n    409 Conflict: Document not ready, has no content, or user session limit exceeded\n    503 Service Unavailable: Database connection issues\n    500 Internal Server Error: Unexpected errors","operationId":"create_chat_session_api_v1_chat_sessions_post","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateSessionData"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatSessionResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"bearerAuth":[]}]},"get":{"tags":["chat"],"summary":"List Chat Sessions","description":"List chat sessions with filtering options and comprehensive error handling.\n\nThis endpoint provides enhanced validation and filtering capabilities for chat sessions,\nincluding specific validation for user_id, document_id filtering, and pagination parameters.\n\nArgs:\n    params: Search parameters (user_id, document_id, active_only, limit, skip)\n\nReturns:\n    SessionListResponse: List of sessions with metadata\n    \nRaises:\n    400 Bad Request: Invalid or missing parameters\n    404 Not Found: User has no sessions\n    500 Internal Server Error: Database or processing errors","operationId":"list_chat_sessions_api_v1_chat_sessions_get","parameters":[{"name":"user_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter sessions by user ID","title":"User Id"},"description":"Filter sessions by user ID"},{"name":"document_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter sessions by document ID","title":"Document Id"},"description":"Filter sessions by document ID"},{"name":"active_only","in":"query","required":false,"schema":{"type":"boolean","description":"Only return active sessions","default":true,"title":"Active Only"},"description":"Only return active sessions"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"Maximum number of results","default":20,"title":"Limit"},"description":"Maximum number of results"},{"name":"skip","in":"query","required":false,"schema":{"type":"integer","minimum":0,"description":"Number of results to skip","default":0,"title":"Skip"},"description":"Number of results to skip"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SessionListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/chat/ask":{"post":{"tags":["chat"],"summary":"Ask Question","description":"Ask a question about a document with streaming response.\n\nArgs:\n    data: Question data (session_id, user_id, document_id, question)\n\nReturns:\n    StreamingResponse: Streaming chat response","operationId":"ask_question_api_v1_chat_ask_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatQuestionData"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/chat/sessions/{session_id}":{"get":{"tags":["chat"],"summary":"Get Session Info","description":"Get information about a specific chat session.\n\nArgs:\n    session_id: Session identifier\n    user_id: User requesting the session\n\nReturns:\n    ChatSessionResponse: Session information","operationId":"get_session_info_api_v1_chat_sessions__session_id__get","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}},{"name":"user_id","in":"query","required":true,"schema":{"type":"string","description":"User ID requesting the session","title":"User Id"},"description":"User ID requesting the session"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatSessionResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"bearerAuth":[]}]},"delete":{"tags":["chat"],"summary":"Delete Chat Session","description":"Delete a chat session and all its interactions.\n\nArgs:\n    session_id: Session identifier\n    user_id: User performing the deletion\n\nReturns:\n    SessionDeleteResponse: Deletion results","operationId":"delete_chat_session_api_v1_chat_sessions__session_id__delete","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}},{"name":"user_id","in":"query","required":true,"schema":{"type":"string","description":"User ID performing the deletion","title":"User Id"},"description":"User ID performing the deletion"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SessionDeleteResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/chat/sessions/{session_id}/interactions":{"get":{"tags":["chat"],"summary":"Get Session Interactions","description":"Get chat interactions for a session.\n\nArgs:\n    session_id: Session identifier\n    user_id: User requesting the interactions\n    limit: Maximum number of interactions\n    skip: Number of interactions to skip\n\nReturns:\n    InteractionListResponse: List of interactions","operationId":"get_session_interactions_api_v1_chat_sessions__session_id__interactions_get","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}},{"name":"user_id","in":"query","required":true,"schema":{"type":"string","description":"User ID requesting the interactions","title":"User Id"},"description":"User ID requesting the interactions"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"Maximum number of interactions","default":50,"title":"Limit"},"description":"Maximum number of interactions"},{"name":"skip","in":"query","required":false,"schema":{"type":"integer","minimum":0,"description":"Number of interactions to skip","default":0,"title":"Skip"},"description":"Number of interactions to skip"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/InteractionListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/chat/stats":{"get":{"tags":["chat"],"summary":"Get Chat Stats","description":"Get chat statistics.\n\nArgs:\n    user_id: Optional user filter\n    document_id: Optional document filter\n    days: Number of days to analyze\n\nReturns:\n    ChatStatsResponse: Chat statistics","operationId":"get_chat_stats_api_v1_chat_stats_get","parameters":[{"name":"user_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by user ID","title":"User Id"},"description":"Filter by user ID"},{"name":"document_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by document ID","title":"Document Id"},"description":"Filter by document ID"},{"name":"days","in":"query","required":false,"schema":{"type":"integer","maximum":365,"minimum":1,"description":"Number of days to analyze","default":30,"title":"Days"},"description":"Number of days to analyze"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatStatsResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/search/patients":{"get":{"tags":["fuzzy-search"],"summary":"Search Patients By Name","description":"Search for documents by patient name using fuzzy matching.\n\nThis endpoint implements advanced fuzzy search algorithms to find patient documents\nbased on partial or complete patient names. It supports:\n\n- Exact matches\n- Prefix matches (names starting with search term)\n- Substring matches (names containing search term)\n- Fuzzy similarity matching\n- MongoDB text search\n\nThe user_id parameter is required to ensure users can only search within their own documents.\n\nArgs:\n    params: Fuzzy search parameters including search term, user_id (required), filters, and options\n\nReturns:\n    FuzzySearchResponse: Matched documents with similarity scores and metadata\n\nExamples:\n    - Search for \"GARCIA\" finds \"GARCIA, MARIA\" and \"GARCIA LOPEZ, JUAN\"\n    - Search for \"MAR\" finds \"MARIA\", \"MARTINEZ\", \"MARQUEZ\"\n    - Search for \"PEDRO JAV\" finds \"PEDRO JAVIER\"","operationId":"search_patients_by_name_api_v1_search_patients_get","parameters":[{"name":"search_term","in":"query","required":true,"schema":{"type":"string","description":"Patient name or partial name to search for","title":"Search Term"},"description":"Patient name or partial name to search for"},{"name":"user_id","in":"query","required":true,"schema":{"type":"string","minLength":1,"description":"Filter results by user ID (required)","title":"User Id"},"description":"Filter results by user ID (required)"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"Maximum number of results","default":20,"title":"Limit"},"description":"Maximum number of results"},{"name":"skip","in":"query","required":false,"schema":{"type":"integer","minimum":0,"description":"Number of results to skip","default":0,"title":"Skip"},"description":"Number of results to skip"},{"name":"min_similarity","in":"query","required":false,"schema":{"type":"number","maximum":1.0,"minimum":0.0,"description":"Minimum similarity score threshold","default":0.3,"title":"Min Similarity"},"description":"Minimum similarity score threshold"},{"name":"include_score","in":"query","required":false,"schema":{"type":"boolean","description":"Include similarity score in results","default":true,"title":"Include Score"},"description":"Include similarity score in results"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FuzzySearchResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/search/patients/suggestions":{"get":{"tags":["fuzzy-search"],"summary":"Get Patient Name Suggestions","description":"Get patient name suggestions for autocomplete functionality.\n\nThis endpoint provides intelligent autocomplete suggestions for patient names\nbased on a partial search term. It's optimized for fast real-time suggestions\nand implements smart fuzzy matching to handle typos and partial matches.\n\nThe user_id parameter is required to ensure users can only get suggestions\nfrom their own documents.\n\nArgs:\n    params: Suggestion search parameters including partial_term, user_id (required), and limit\n\nReturns:\n    SearchSuggestionsResponse: List of suggested patient names with metadata\n\nExamples:\n    - \"MAR\" might suggest: [\"MARÍA GONZÁLEZ\", \"MARIO RODRÍGUEZ\", \"MARTHA LÓPEZ\"]\n    - \"GARC\" might suggest: [\"GARCÍA, JUAN\", \"GARCÍA LÓPEZ, MARÍA\"]","operationId":"get_patient_name_suggestions_api_v1_search_patients_suggestions_get","parameters":[{"name":"partial_term","in":"query","required":true,"schema":{"type":"string","description":"Partial patient name for suggestions","title":"Partial Term"},"description":"Partial patient name for suggestions"},{"name":"user_id","in":"query","required":true,"schema":{"type":"string","minLength":1,"description":"Filter suggestions by user ID (required)","title":"User Id"},"description":"Filter suggestions by user ID (required)"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":50,"minimum":1,"description":"Maximum number of suggestions","default":10,"title":"Limit"},"description":"Maximum number of suggestions"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SearchSuggestionsResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/search/patients/{patient_name}/documents":{"get":{"tags":["fuzzy-search"],"summary":"Get Documents By Patient Name","description":"Get all documents for a specific patient by exact name match.\n\nThis endpoint finds all documents associated with a specific patient\nusing exact name matching. It's useful when you know the exact patient name\nand want to retrieve all their documents.\n\nThe user_id parameter is required to ensure users can only see documents\nfrom their own account.\n\nArgs:\n    patient_name: Exact patient name to search for\n    user_id: User ID to filter results (required)\n    limit: Maximum number of results\n    skip: Number of results to skip\n\nReturns:\n    FuzzySearchResponse: All documents for the specified patient","operationId":"get_documents_by_patient_name_api_v1_search_patients__patient_name__documents_get","parameters":[{"name":"patient_name","in":"path","required":true,"schema":{"type":"string","title":"Patient Name"}},{"name":"user_id","in":"query","required":true,"schema":{"type":"string","minLength":1,"description":"Filter results by user ID (required)","title":"User Id"},"description":"Filter results by user ID (required)"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"Maximum number of results","default":20,"title":"Limit"},"description":"Maximum number of results"},{"name":"skip","in":"query","required":false,"schema":{"type":"integer","minimum":0,"description":"Number of results to skip","default":0,"title":"Skip"},"description":"Number of results to skip"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FuzzySearchResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/tokens/speech":{"get":{"tags":["tokens"],"summary":"Get Speech Token","description":"Get Azure Speech Services authentication token.\n\nReturns:\n    AzureSpeechTokenResponse: Token and metadata for Speech Services (STT/TTS)","operationId":"get_speech_token_api_v1_tokens_speech_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AzureSpeechTokenResponse"}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/tokens/storage":{"get":{"tags":["tokens"],"summary":"Get Storage Token","description":"Get Azure Storage SAS token for blob container access.\n\nReturns:\n    AzureStorageTokenResponse: SAS token and metadata for Storage access","operationId":"get_storage_token_api_v1_tokens_storage_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AzureStorageTokenResponse"}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/tokens/speech/info":{"get":{"tags":["tokens"],"summary":"Get Speech Token Info","description":"Get information about the current Azure Speech token.\n\nReturns:\n    Dict: Token information and status","operationId":"get_speech_token_info_api_v1_tokens_speech_info_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/tokens/storage/info":{"get":{"tags":["tokens"],"summary":"Get Storage Token Info","description":"Get information about the current Azure Storage token.\n\nReturns:\n    Dict: Token information and status","operationId":"get_storage_token_info_api_v1_tokens_storage_info_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/tokens/speech/invalidate":{"post":{"tags":["tokens"],"summary":"Invalidate Speech Token","description":"Invalidate the cached Azure Speech token.\n\nReturns:\n    Dict: Success message","operationId":"invalidate_speech_token_api_v1_tokens_speech_invalidate_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/tokens/storage/invalidate":{"post":{"tags":["tokens"],"summary":"Invalidate Storage Token","description":"Invalidate the cached Azure Storage token.\n\nReturns:\n    Dict: Success message","operationId":"invalidate_storage_token_api_v1_tokens_storage_invalidate_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"bearerAuth":[]}]}},"/api/v1/tokens/storage/blob/{blob_name}":{"get":{"tags":["tokens"],"summary":"Get Blob Url","description":"Get a signed URL for a specific blob.\n\nArgs:\n    blob_name: Name of the blob\n    \nReturns:\n    Dict: Blob URL with SAS token","operationId":"get_blob_url_api_v1_tokens_storage_blob__blob_name__get","parameters":[{"name":"blob_name","in":"path","required":true,"schema":{"type":"string","title":"Blob Name"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"bearerAuth":[]}]}},"/":{"get":{"tags":["health"],"summary":"Root","description":"Root endpoint with basic API information.","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"bearerAuth":[]}]}},"/health":{"get":{"tags":["health"],"summary":"Health Check","description":"Basic health check endpoint.","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"bearerAuth":[]}]}}},"components":{"schemas":{"AzureSpeechTokenResponse":{"properties":{"access_token":{"type":"string","title":"Access Token","description":"Azure Speech Services access token"},"token_type":{"type":"string","title":"Token Type","description":"Type of token (Bearer)"},"expires_in":{"type":"integer","title":"Expires In","description":"Token expiration time in seconds"},"region":{"type":"string","title":"Region","description":"Azure Speech Services region"},"issued_at":{"type":"string","title":"Issued At","description":"Timestamp when token was issued"}},"type":"object","required":["access_token","token_type","expires_in","region","issued_at"],"title":"AzureSpeechTokenResponse","description":"Response schema for Azure Speech token."},"AzureStorageTokenResponse":{"properties":{"sas_token":{"type":"string","title":"Sas Token","description":"Azure Storage SAS token"},"container_url":{"type":"string","title":"Container Url","description":"Complete container URL with SAS token"},"base_url":{"type":"string","title":"Base Url","description":"Base URL for the storage account"},"container_name":{"type":"string","title":"Container Name","description":"Name of the storage container"},"account_name":{"type":"string","title":"Account Name","description":"Storage account name"},"expires_at":{"type":"string","title":"Expires At","description":"Token expiration timestamp (ISO format)"},"permissions":{"type":"string","title":"Permissions","description":"Token permissions (e.g., 'rl' for read and list)"},"resource_type":{"type":"string","title":"Resource Type","description":"Resource type (container)"},"issued_at":{"type":"string","title":"Issued At","description":"Timestamp when token was issued"}},"type":"object","required":["sas_token","container_url","base_url","container_name","account_name","expires_at","permissions","resource_type","issued_at"],"title":"AzureStorageTokenResponse","description":"Response schema for Azure Storage token."},"BatchUploadResponse":{"properties":{"batch_id":{"type":"string","title":"Batch Id","description":"Unique batch ID"},"batch_timestamp":{"type":"string","title":"Batch Timestamp","description":"Timestamp when batch processing started"},"batch_description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Batch Description","description":"Description of the batch"},"user_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"User Id","description":"User ID who uploaded the batch"},"total_files":{"type":"integer","title":"Total Files","description":"Total number of files in the batch"},"processed_count":{"type":"integer","title":"Processed Count","description":"Number of successfully processed documents"},"failed_count":{"type":"integer","title":"Failed Count","description":"Number of failed documents"},"success_rate":{"type":"number","title":"Success Rate","description":"Success rate as percentage (0-100)"},"processing_status":{"type":"string","title":"Processing Status","description":"Overall batch processing status (completed, failed, partial_success)"},"successful_documents":{"items":{"$ref":"#/components/schemas/DocumentUploadResponse"},"type":"array","title":"Successful Documents","description":"List of successfully processed documents"},"failed_documents":{"items":{"type":"object"},"type":"array","title":"Failed Documents","description":"List of failed documents with error details"},"processing_summary":{"type":"object","title":"Processing Summary","description":"Processing summary with statistics"}},"type":"object","required":["batch_id","batch_timestamp","batch_description","user_id","total_files","processed_count","failed_count","success_rate","processing_status","successful_documents","failed_documents","processing_summary"],"title":"BatchUploadResponse","description":"Response schema for batch document upload."},"Body_upload_document_api_v1_documents_upload_post":{"properties":{"file":{"type":"string","format":"binary","title":"File","description":"Document file to upload"},"user_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"User Id","description":"User ID who is uploading the document"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description","description":"Document description"},"tags":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Tags","description":"Document tags as JSON array"}},"type":"object","required":["file"],"title":"Body_upload_document_api_v1_documents_upload_post"},"Body_upload_documents_batch_api_v1_documents_upload_batch_post":{"properties":{"files":{"items":{"type":"string","format":"binary"},"type":"array","title":"Files","description":"List of files to upload"},"user_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"User Id","description":"User ID who is uploading the documents"},"batch_description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Batch Description","description":"Common description for all documents"},"batch_tags":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Batch Tags","description":"Common tags as JSON array"}},"type":"object","required":["files"],"title":"Body_upload_documents_batch_api_v1_documents_upload_batch_post"},"ChatInteractionResponse":{"properties":{"interaction_id":{"type":"string","title":"Interaction Id","description":"Unique interaction identifier"},"session_id":{"type":"string","title":"Session Id","description":"Session identifier"},"user_id":{"type":"string","title":"User Id","description":"User identifier"},"document_id":{"type":"string","title":"Document Id","description":"Document identifier"},"question":{"type":"string","title":"Question","description":"User's question"},"response":{"type":"string","title":"Response","description":"Assistant's response"},"created_at":{"type":"string","title":"Created At","description":"Interaction timestamp"},"metadata":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Metadata","description":"Additional interaction metadata"}},"type":"object","required":["interaction_id","session_id","user_id","document_id","question","response","created_at"],"title":"ChatInteractionResponse","description":"Response schema for chat interaction."},"ChatQuestionData":{"properties":{"session_id":{"type":"string","title":"Session Id","description":"Session ID for the chat conversation"},"user_id":{"type":"string","title":"User Id","description":"User ID making the question"},"document_id":{"type":"string","title":"Document Id","description":"Document ID to ask about"},"question":{"type":"string","maxLength":2000,"minLength":1,"title":"Question","description":"User's question about the document"}},"type":"object","required":["session_id","user_id","document_id","question"],"title":"ChatQuestionData","description":"Validation model for chat question."},"ChatSessionResponse":{"properties":{"session_id":{"type":"string","title":"Session Id","description":"Unique session identifier"},"user_id":{"type":"string","title":"User Id","description":"User ID who owns the session"},"document_id":{"type":"string","title":"Document Id","description":"Document ID for this session"},"session_name":{"type":"string","title":"Session Name","description":"Name of the chat session"},"is_active":{"type":"boolean","title":"Is Active","description":"Whether the session is active"},"created_at":{"type":"string","title":"Created At","description":"Session creation timestamp"},"last_interaction_at":{"type":"string","title":"Last Interaction At","description":"Last interaction timestamp"},"interaction_count":{"type":"integer","title":"Interaction Count","description":"Number of interactions in this session"}},"type":"object","required":["session_id","user_id","document_id","session_name","is_active","created_at","last_interaction_at","interaction_count"],"title":"ChatSessionResponse","description":"Response schema for chat session."},"ChatStatsResponse":{"properties":{"period_days":{"type":"integer","title":"Period Days","description":"Number of days analyzed"},"total_interactions":{"type":"integer","title":"Total Interactions","description":"Total number of interactions"},"total_questions":{"type":"integer","title":"Total Questions","description":"Total number of questions"},"total_responses":{"type":"integer","title":"Total Responses","description":"Total number of responses"},"avg_question_length":{"type":"number","title":"Avg Question Length","description":"Average question length in characters"},"avg_response_length":{"type":"number","title":"Avg Response Length","description":"Average response length in characters"},"unique_sessions":{"type":"integer","title":"Unique Sessions","description":"Number of unique sessions"},"unique_documents":{"type":"integer","title":"Unique Documents","description":"Number of unique documents"},"interactions_per_day":{"type":"number","title":"Interactions Per Day","description":"Average interactions per day"}},"type":"object","required":["period_days","total_interactions","total_questions","total_responses","avg_question_length","avg_response_length","unique_sessions","unique_documents","interactions_per_day"],"title":"ChatStatsResponse","description":"Response schema for chat statistics."},"CreateSessionData":{"properties":{"user_id":{"type":"string","title":"User Id","description":"User ID creating the session"},"document_id":{"type":"string","title":"Document Id","description":"Document ID for this session"},"session_name":{"anyOf":[{"type":"string","maxLength":200},{"type":"null"}],"title":"Session Name","description":"Optional custom name for the session"}},"type":"object","required":["user_id","document_id"],"title":"CreateSessionData","description":"Validation model for creating a new chat session."},"DocumentDeleteResponse":{"properties":{"document_id":{"type":"string","title":"Document Id","description":"ID of the deleted document"},"success":{"type":"boolean","title":"Success","description":"Whether deletion was successful"},"message":{"type":"string","title":"Message","description":"Deletion status message"}},"type":"object","required":["document_id","success","message"],"title":"DocumentDeleteResponse","description":"Response schema for document deletion."},"DocumentInfoResponse":{"properties":{"document_id":{"type":"string","title":"Document Id","description":"Unique document ID"},"processing_id":{"type":"string","title":"Processing Id","description":"Processing ID for tracking"},"filename":{"type":"string","title":"Filename","description":"Original filename"},"content_type":{"type":"string","title":"Content Type","description":"MIME type of the document"},"file_size":{"type":"integer","title":"File Size","description":"File size in bytes"},"user_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"User Id","description":"User ID who uploaded the document"},"storage_info":{"type":"object","title":"Storage Info","description":"Storage information"},"extracted_text":{"type":"string","title":"Extracted Text","description":"Text extracted from the document"},"processing_status":{"type":"string","title":"Processing Status","description":"Processing status"},"batch_info":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Batch Info","description":"Batch information if document was processed as part of a batch"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description","description":"Document description"},"tags":{"items":{"type":"string"},"type":"array","title":"Tags","description":"Document tags","default":[]},"expediente":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Expediente","description":"Número de expediente del paciente"},"nombre_paciente":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Nombre Paciente","description":"Nombre completo del paciente"},"numero_episodio":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Numero Episodio","description":"Número de episodio médico"},"categoria":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Categoria","description":"Categoría del documento médico (EMER, CONS, etc.)"},"medical_info_valid":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Medical Info Valid","description":"Indica si la información médica fue parseada correctamente"},"medical_info_error":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Medical Info Error","description":"Error en el parsing de información médica, si existe"},"created_at":{"type":"string","format":"date-time","title":"Created At","description":"Creation timestamp"},"updated_at":{"type":"string","format":"date-time","title":"Updated At","description":"Last update timestamp"}},"type":"object","required":["document_id","processing_id","filename","content_type","file_size","user_id","storage_info","extracted_text","processing_status","created_at","updated_at"],"title":"DocumentInfoResponse","description":"Response schema for document information."},"DocumentSearchResponse":{"properties":{"documents":{"items":{"$ref":"#/components/schemas/DocumentInfoResponse"},"type":"array","title":"Documents","description":"List of matching documents"},"total_found":{"type":"integer","title":"Total Found","description":"Total number of documents found"},"limit":{"type":"integer","title":"Limit","description":"Maximum number of results requested"},"skip":{"type":"integer","title":"Skip","description":"Number of results skipped"},"returned_count":{"type":"integer","title":"Returned Count","description":"Actual number of documents returned in this response"},"has_next":{"type":"boolean","title":"Has Next","description":"Whether there are more results available"},"has_prev":{"type":"boolean","title":"Has Prev","description":"Whether there are previous results available"},"current_page":{"type":"integer","title":"Current Page","description":"Current page number (1-based)"},"total_pages":{"type":"integer","title":"Total Pages","description":"Total number of pages available"},"applied_filters":{"type":"object","title":"Applied Filters","description":"Filters that were applied to the search"},"request_id":{"type":"string","title":"Request Id","description":"Unique request identifier for tracking"},"search_timestamp":{"type":"string","title":"Search Timestamp","description":"Timestamp when the search was performed"}},"type":"object","required":["documents","total_found","limit","skip","returned_count","has_next","has_prev","current_page","total_pages","applied_filters","request_id","search_timestamp"],"title":"DocumentSearchResponse","description":"Response schema for document search with enhanced pagination metadata."},"DocumentUploadResponse":{"properties":{"document_id":{"type":"string","title":"Document Id","description":"Unique document ID in the database"},"processing_id":{"type":"string","title":"Processing Id","description":"Unique processing ID for tracking"},"filename":{"type":"string","title":"Filename","description":"Original filename of the uploaded document"},"storage_info":{"type":"object","title":"Storage Info","description":"Storage information including blob name and URL"},"ocr_summary":{"type":"object","title":"Ocr Summary","description":"Summary of OCR processing results"},"processing_status":{"type":"string","title":"Processing Status","description":"Current processing status"},"processing_timestamp":{"type":"string","title":"Processing Timestamp","description":"Timestamp when processing was completed"},"expediente":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Expediente","description":"Número de expediente del paciente"},"nombre_paciente":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Nombre Paciente","description":"Nombre completo del paciente"},"numero_episodio":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Numero Episodio","description":"Número de episodio médico"},"categoria":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Categoria","description":"Categoría del documento médico (EMER, CONS, etc.)"},"medical_info_valid":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Medical Info Valid","description":"Indica si la información médica fue parseada correctamente"},"medical_info_error":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Medical Info Error","description":"Error en el parsing de información médica, si existe"}},"type":"object","required":["document_id","processing_id","filename","storage_info","ocr_summary","processing_status","processing_timestamp"],"title":"DocumentUploadResponse","description":"Response schema for document upload."},"FuzzyDocumentMatch":{"properties":{"document_id":{"type":"string","title":"Document Id","description":"Unique document ID"},"processing_id":{"type":"string","title":"Processing Id","description":"Processing ID for tracking"},"filename":{"type":"string","title":"Filename","description":"Original filename"},"content_type":{"type":"string","title":"Content Type","description":"MIME type of the document"},"file_size":{"type":"integer","title":"File Size","description":"File size in bytes"},"user_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"User Id","description":"User ID who uploaded the document"},"storage_info":{"type":"object","title":"Storage Info","description":"Storage information"},"extracted_text":{"type":"string","title":"Extracted Text","description":"Text extracted from the document"},"processing_status":{"type":"string","title":"Processing Status","description":"Processing status"},"batch_info":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Batch Info","description":"Batch information if document was processed as part of a batch"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description","description":"Document description"},"tags":{"items":{"type":"string"},"type":"array","title":"Tags","description":"Document tags","default":[]},"expediente":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Expediente","description":"Número de expediente del paciente"},"nombre_paciente":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Nombre Paciente","description":"Nombre completo del paciente"},"numero_episodio":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Numero Episodio","description":"Número de episodio médico"},"categoria":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Categoria","description":"Categoría del documento médico (EMER, CONS, etc.)"},"medical_info_valid":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Medical Info Valid","description":"Indica si la información médica fue parseada correctamente"},"medical_info_error":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Medical Info Error","description":"Error en el parsing de información médica, si existe"},"created_at":{"type":"string","format":"date-time","title":"Created At","description":"Creation timestamp"},"updated_at":{"type":"string","format":"date-time","title":"Updated At","description":"Last update timestamp"},"similarity_score":{"type":"number","title":"Similarity Score","description":"Similarity score between search term and patient name (0.0 to 1.0)"},"match_type":{"type":"string","title":"Match Type","description":"Type of match (exact, prefix, substring, fuzzy)"}},"type":"object","required":["document_id","processing_id","filename","content_type","file_size","user_id","storage_info","extracted_text","processing_status","created_at","updated_at","similarity_score","match_type"],"title":"FuzzyDocumentMatch","description":"Document match with fuzzy search metadata."},"FuzzySearchResponse":{"properties":{"search_term":{"type":"string","title":"Search Term","description":"Original search term"},"normalized_term":{"type":"string","title":"Normalized Term","description":"Normalized search term used for matching"},"total_found":{"type":"integer","title":"Total Found","description":"Total number of documents found"},"documents":{"items":{"$ref":"#/components/schemas/FuzzyDocumentMatch"},"type":"array","title":"Documents","description":"List of matching documents with similarity scores"},"limit":{"type":"integer","title":"Limit","description":"Maximum number of results requested"},"skip":{"type":"integer","title":"Skip","description":"Number of results skipped"},"returned_count":{"type":"integer","title":"Returned Count","description":"Actual number of documents returned in this response"},"has_next":{"type":"boolean","title":"Has Next","description":"Whether there are more results available"},"has_prev":{"type":"boolean","title":"Has Prev","description":"Whether there are previous results available"},"current_page":{"type":"integer","title":"Current Page","description":"Current page number (1-based)"},"total_pages":{"type":"integer","title":"Total Pages","description":"Total number of pages available"},"search_strategies_used":{"items":{"type":"string"},"type":"array","title":"Search Strategies Used","description":"List of search strategies used"},"min_similarity_threshold":{"type":"number","title":"Min Similarity Threshold","description":"Minimum similarity threshold applied"},"search_timestamp":{"type":"string","title":"Search Timestamp","description":"Timestamp when the search was performed"}},"type":"object","required":["search_term","normalized_term","total_found","documents","limit","skip","returned_count","has_next","has_prev","current_page","total_pages","search_strategies_used","min_similarity_threshold","search_timestamp"],"title":"FuzzySearchResponse","description":"Response schema for fuzzy patient search."},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"InteractionListResponse":{"properties":{"interactions":{"items":{"$ref":"#/components/schemas/ChatInteractionResponse"},"type":"array","title":"Interactions","description":"List of chat interactions"},"total_found":{"type":"integer","title":"Total Found","description":"Total number of interactions found"},"limit":{"type":"integer","title":"Limit","description":"Limit applied to results"},"skip":{"type":"integer","title":"Skip","description":"Number of results skipped"}},"type":"object","required":["interactions","total_found","limit","skip"],"title":"InteractionListResponse","description":"Response schema for interaction list."},"SearchSuggestionsResponse":{"properties":{"partial_term":{"type":"string","title":"Partial Term","description":"Partial search term provided"},"suggestions":{"items":{"type":"string"},"type":"array","title":"Suggestions","description":"List of suggested patient names"},"total_suggestions":{"type":"integer","title":"Total Suggestions","description":"Total number of suggestions returned"},"limit":{"type":"integer","title":"Limit","description":"Maximum number of suggestions requested"},"returned_count":{"type":"integer","title":"Returned Count","description":"Actual number of suggestions returned in this response"},"has_next":{"type":"boolean","title":"Has Next","description":"Whether there are more suggestions available"},"has_prev":{"type":"boolean","title":"Has Prev","description":"Whether there are previous suggestions available"},"current_page":{"type":"integer","title":"Current Page","description":"Current page number (1-based)"},"total_pages":{"type":"integer","title":"Total Pages","description":"Total number of pages available"},"search_timestamp":{"type":"string","title":"Search Timestamp","description":"Timestamp when the search was performed"}},"type":"object","required":["partial_term","suggestions","total_suggestions","limit","returned_count","has_next","has_prev","current_page","total_pages","search_timestamp"],"title":"SearchSuggestionsResponse","description":"Response schema for search suggestions."},"SessionDeleteResponse":{"properties":{"session_id":{"type":"string","title":"Session Id","description":"ID of the deleted session"},"deleted":{"type":"boolean","title":"Deleted","description":"Whether the session was successfully deleted"},"interactions_deleted":{"type":"integer","title":"Interactions Deleted","description":"Number of interactions deleted with the session"},"message":{"type":"string","title":"Message","description":"Deletion result message"},"deleted_timestamp":{"type":"string","title":"Deleted Timestamp","description":"Timestamp when the session was deleted"}},"type":"object","required":["session_id","deleted","interactions_deleted","message","deleted_timestamp"],"title":"SessionDeleteResponse","description":"Response schema for session deletion."},"SessionListResponse":{"properties":{"sessions":{"items":{"$ref":"#/components/schemas/ChatSessionResponse"},"type":"array","title":"Sessions","description":"List of chat sessions"},"total_found":{"type":"integer","title":"Total Found","description":"Total number of sessions found"},"limit":{"type":"integer","title":"Limit","description":"Limit applied to results"},"skip":{"type":"integer","title":"Skip","description":"Number of results skipped"},"returned_count":{"type":"integer","title":"Returned Count","description":"Actual number of sessions returned in this response"},"has_next":{"type":"boolean","title":"Has Next","description":"Whether there are more results available"},"has_prev":{"type":"boolean","title":"Has Prev","description":"Whether there are previous results available"},"current_page":{"type":"integer","title":"Current Page","description":"Current page number (1-based)"},"total_pages":{"type":"integer","title":"Total Pages","description":"Total number of pages available"},"applied_filters":{"type":"object","title":"Applied Filters","description":"Filters that were applied to the search"},"request_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Request Id","description":"Unique request identifier for tracking"},"search_timestamp":{"type":"string","title":"Search Timestamp","description":"Timestamp when the search was performed"}},"type":"object","required":["sessions","total_found","limit","skip","returned_count","has_next","has_prev","current_page","total_pages","applied_filters","search_timestamp"],"title":"SessionListResponse","description":"Response schema for session list with enhanced pagination metadata."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"bearerAuth":{"type":"http","scheme":"bearer","bearerFormat":"JWT"}}},"tags":[{"name":"documents","description":"Operaciones relacionadas con la carga y procesamiento de documentos médicos"},{"name":"chat","description":"Sistema de chat inteligente para preguntas sobre documentos médicos con Azure OpenAI"},{"name":"fuzzy-search","description":"Búsqueda fuzzy de documentos por nombre de paciente con algoritmos de similitud"},{"name":"tokens","description":"Tokens de autenticación para Azure Speech Services y Azure Storage"},{"name":"health","description":"Endpoints para verificar el estado de la aplicación"}]}